import logger from"../logger.js";class PlatformManager{constructor(){this.cache={}}loadBytes(e,r){if(e in this.cache)return r(this.cache[e]);fetch(e).then(e=>e.arrayBuffer()).then(t=>{this.cache[e]=t,r(t)})}loadLive2DModel(e,r){let t=null;this.loadBytes(e,e=>{t=Live2DModelWebGL.loadModel(e),r(t)})}loadTexture(e,r,t,a){const o=new Image;o.crossOrigin="anonymous",o.src=t,o.onload=()=>{const t=document.getElementById("live2d").getContext("webgl2",{premultipliedAlpha:!0,preserveDrawingBuffer:!0});let l=t.createTexture();if(!l)return logger.error("Failed to generate gl texture name."),-1;0==e.isPremultipliedAlpha()&&t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,l),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.generateMipmap(t.TEXTURE_2D),e.setTexture(r,l),l=null,"function"==typeof a&&a()},o.onerror=()=>{logger.error("Failed to load image : "+t)}}jsonParseFromBytes(e){let r;const t=new Uint8Array(e,0,3);r=239==t[0]&&187==t[1]&&191==t[2]?String.fromCharCode.apply(null,new Uint8Array(e,3)):String.fromCharCode.apply(null,new Uint8Array(e));return JSON.parse(r)}}export default PlatformManager;